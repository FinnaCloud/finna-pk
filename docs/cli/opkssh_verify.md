## finna-pk verify

Verify an SSH key (used by sshd AuthorizedKeysCommand)

### Synopsis

Verify extracts a PK token from a base64-encoded SSH certificate and verifies it against policy. It expects an allowed provider file at /etc/finna-pk/providers and a user policy file at either /etc/finna-pk/auth_id or ~/.finna-pk/auth_id.

This command is intended to be called by sshd as an AuthorizedKeysCommand:
  https://man.openbsd.org/sshd_config#AuthorizedKeysCommand

During installation, finna-pk typically adds these lines to /etc/ssh/sshd_config:
  AuthorizedKeysCommand /usr/local/bin/finna-pk verify %%u %%k %%t
  AuthorizedKeysCommandUser finna-pkuser

Where the tokens in /etc/ssh/sshd_config are defined as:
  %%u   Target username (requested principal)
  %%k   Base64-encoded SSH public key (SSH certificate) provided for authentication
  %%t   Public key type (SSH certificate format, e.g., ecdsa-sha2-nistp256-cert-v01@openssh.com)

Verification checks performed:
  1. Ensures the PK token is properly formed, signed, and issued by the specified OpenID Provider (OP).
  2. Confirms the PK token's issue (iss) and client ID (audience) are listed in the allowed provider file (/etc/finna-pk/providers) and the token is not expired.
  3. Validates the identity (email or sub) in the PK token against user policies (/etc/finna-pk/auth_id or ~/.finna-pk/auth_id) to ensure it can assume the requested username (principal).

If all checks pass, Verify authorizes the SSH connection.

Arguments:
  principal    Target username.
  cert         Base64-encoded SSH certificate.
  key_type     SSH certificate key type (e.g., ecdsa-sha2-nistp256-cert-v01@openssh.com)

```
finna-pk verify <principal> <cert> <key_type> [flags]
```

### Examples

```
  finna-pk verify root <base64-encoded-cert> ecdsa-sha2-nistp256-cert-v01@openssh.com
```

### Options

```
      --config-path string   Path to the server config file. Default: /etc/finna-pk/config.yml. (default "/etc/finna-pk/config.yml")
  -h, --help                 help for verify
```

### SEE ALSO

* [finna-pk](finna-pk.md)	 - SSH with OpenPubkey

###### Auto generated by spf13/cobra on 13-Oct-2025
